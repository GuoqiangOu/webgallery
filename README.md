# Webgallery REST API Documentation
### Authentication
- description: register a new user
- request: `POST /register/`
    - content-type: `application/json`
    - body: object
      - username: (string) the username of this new user
      - password: the password of this new user
- response: 200
    - content-type: `application/json`
    - body: string
      - _id: (string) the username of this new user
- response: 400
    - body: username/password is missing
- response: 409
    - body: user with username already exists
``` 
curl -H "Content-Type: application/json" 
     -X POST -d '{"username":"ouguoqia","password":"123"}' -c cookie.txt localhost:3000/register/
```

- description: login a user
- request: `POST /login/`
    - content-type: `application/json`
    - body: object
      - username: (string) the username of this new user
      - password: the password of this new user
- response: 200
    - content-type: `application/json`
    - body: string
      - _id: (string) the username of this new user
- response: 400
    - body: username/password is missing
- response: 401
    - body: access denied
``` 
curl -H "Content-Type: application/json" 
     -X POST -d '{"username":"ouguoqia","password":"123"}' -c cookie.txt localhost:3000/login/
```

- description: logout a user
- request: `GET /logout/`
    - content-type: `application/json`
- response: 200
    - content-type: `application/json`
    - body: empty string
``` 
curl -b cookie.txt -c cookie.txt localhost:3000/logout/
```

### Create
- description: create a new image
- request: `POST /api/images/:author/`
    - content-type: `application/json`
    - body: object
      - title: (string) the title of the image
      - picture: image file object
- response: 200
    - content-type: `application/json`
    - body: object
      - _id: (string) the image id generated by NeDB
      - title: (string) the title of the image
      - author: (string) the author of the image
      - createdAt: (date) date of this image is created
      - updatedAt: (date) date of this image is last updated
      - picture: image file object
- response: 401
    - body: Access denied
``` 
$ curl -X POST 
       -H "Content-Type: application/json" 
       -d '{"title":"hello world", "picture": file}' 
       http://localhost:3000/api/images/ouguoqia/
```

- description: create a new comment
- request: `POST /api/comments/`
    - content-type: `application/json`
    - body: object
      - imageId: (string) the _id of the image of this comment, which generated by NeDB
      - author: (string) the author of this comment
      - content: (string) the content of this comment
- response: 200
    - content-type: `application/json`
    - body: object
      - _id: (string) the comment id generated by NeDB
      - imageId: (string) the _id of the image of this comment, which generated by NeDB
      - author: (string) the author of this comment
      - content: (string) the content of this comment
      - createdAt: (date) date of this comment is created
      - updatedAt: (date) date of this comment is last updated
- response: 401
    - body: Access denied
``` 
$ curl -X POST 
       -H "Content-Type: application/json" 
       -d '{"imageId":"hxshXSEjxP9V5aJ6", "author":"oug", "content": "I am a comment text"}' 
       http://localhost:3000/api/comments/
```

### Read

- description: retrieve the latest added image 
- request: `GET /api/images/:imageId/`   
- response: 200
    - content-type: `application/json`
    - body: object
- response: 401
    - body: Access denied
- response: 404
    - body: Image with imageId <imageId> does not exist.
``` 
$ curl http://localhost:3000/api/images/hxshXSEjxP9V5aJ6/
``` 

- description: retrieve the latest 10 comments of the image with the given imageId
- request: `GET /api/comments/:imageId/`
- response: 200
    - content-type: `application/json`
    - body: list of objects
      - _id: (string) the comment id generated by NeDB
      - imageId: (string) the _id of the image of this comment, which generated by NeDB
      - author: (string) the author of this comment
      - content: (string) the content of this comment
      - createdAt: (date) date of this comment is created
      - updatedAt: (date) date of this comment is last updated
- response: 401
    - body: Access denied
``` 
$ curl http://localhost:3000/api/comments/hxshXSEjxP9V5aJ6/
``` 

- description: retrieve the left/right (previous/next) image object of the image with the given author name
- request: `GET /api/images/:author/:action/`
- response: 200
    - content-type: `application/json`
    - body: list of objects
      - _id: (string) a user id/name
      - image object
          - _id: (string) the image id generated by NeDB
          - title: (string) the title of the image
          - author: (string) the author of the image
          - createdAt: (date) date of this image is created
          - updatedAt: (date) date of this image is last updated
          - picture: image file object
- response: 400
    - body: Invalid Argument, the action has to be either left or right.
- response: 404
    - body: Author with author name <author name> does not exist.
``` 
$ curl http://localhost:3000/api/images/ouguoqia/left/
```

- description: retrieve the left/right (previous/next) image object of the image with the given imageId and authorn name
- request: `GET /api/images/:author/:imageId/:action/`
- response: 200
    - content-type: `application/json`
    - body: object
      - _id: (string) the image id generated by NeDB
      - title: (string) the title of the image
      - author: (string) the author of the image
      - createdAt: (date) date of this image is created
      - updatedAt: (date) date of this image is last updated
      - picture: image file object
- response: 400
    - body: Invalid Argument, the action has to be either left or right.
- response: 401
    - body: Access denied
- response: 404
    - body: Image with imageId <imageId> does not exist.
``` 
$ curl http://localhost:3000/api/images/ouguoqia/hxshXSEjxP9V5aJ6/left/
```

- description: retrieve the left/right (previous/next) page of comments (10 of them) of the image with the given imageId
- request: `GET /api/comments/:imageId/:action/:page/`
- response: 200
    - content-type: `application/json`
    - body: list of objects
      - _id: (string) the comment id generated by NeDB
      - imageId: (string) the _id of the image of this comment, which generated by NeDB
      - author: (string) the author of this comment
      - content: (string) the content of this comment
      - createdAt: (date) date of this comment is created
      - updatedAt: (date) date of this comment is last updated
- response: 400
    - body: Invalid Argument, the action has to be either left or right.
- response: 401
    - body: Access denied
- response: 404
    - body: Image with imageId <imageId> does not exist.
``` 
$ curl http://localhost:3000/api/comments/hxshXSEjxP9V5aJ6/left/2/
```
  
### Delete
  
- description: delete a image with the given imageId and all the comments of this image
- request: `DELETE /api/images/:imageId/`
- response: 200
    - content-type: `application/json`
    - body: object
      - _id: (string) the image id of the last uploaded image
      - title: (string) the title of the image
      - author: (string) the author of the image
      - createdAt: (date) date of this image is created
      - updatedAt: (date) date of this image is last updated
      - picture: image file object
- response: 401
    - body: Access denied
- response: 404
    - body: Image with imageId <imageId> does not exist.
```
$ curl -X DELETE
       http://localhost:3000/api/images/hxshXSEjxP9V5aJ6/
``` 

- description: delete a comment with the given commentId on the current comment page
- request: `DELETE /api/comments/:commentId/:page/`
- response: 200
    - content-type: `application/json`
    - body: list of objectsa
      - _id: (string) the comment id generated by NeDB
      - imageId: (string) the _id of the image of this comment, which generated by NeDB
      - author: (string) the author of this comment
      - content: (string) the content of this comment
      - createdAt: (date) date of this comment is created
      - updatedAt: (date) date of this comment is last updated
- response: 401
    - body: Access denied
- response: 404
    - body: Comment with commentId <commentId> does not exsit.
``` 
$ curl -X DELETE
       http://localhost:3000/api/comments/A0vrR0T3yydcRdC9/2/
``` 
